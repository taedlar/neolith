Neolith Developer Reference
===========================

# Debug Logs

The log messages generated by the LPMud Driver goes to the file as specified by `DebugLogFile` in the configuration file.
Typically you'll also want to enable the `LogWithDate` setting to automatically prefix each log message with an ISO-8601 format timestamp.

## Neolith Debug Log Format

In terms of troubleshooting, a structured log format brings many advantages to the administrator.
Human-readbility is equally important for a LPMud's wizards, especially when the wizard has no access to the shell on the MUD server.

Neolith's log format is designed to balance both requirements while keeping the size of debug log as small as possible.
The Neolith Debug Log Format (NDLF) is described as below:

1. The debug log file is a stream of log messages separated by the newline ('\n') character.
2. If a log message starts with a hash sign ('#') or tab ('\t') character, the line is only for human-readaile. Log processing tool can skip these lines safely.
3. Otherwise, the log message can be parsed into multiple columns separated by tab character like below:

```
[timestamp \t] [log-meta \t] message-text \n
```

### Timestamp

If `LogWithDate` is enabled in the configuration file, the LPMud Driver automatically preix each log message with a timestamp in ISO-8601 format that contains:
```
YYYY-MM-DD hh:mm:ss
```

### Log-meta

The log-meta part is a JSON string that contains program-readable information to assist Log Processing tools.
Neolith provides the following meta data in JSON:
| Log-meta | Description |
| --- | --- |
| A JSON array of 4 elements. | An error or trace messages, and the elements are type, source-file, line, function. |
| A JSON object | An informative log message. The contents of JSON object may have its own signature property for Log Processing tool to identify. |

### Mudlib Compatibility

As the log-meta can be easily identified by starting with '`[`' or '`{`' character, a mudlibe using Neolith can continue to write its own log format
while keeping the compatibility with NDLF. A Log Processing tool can locate the log-meta generated by the LPMud Driver while skipping other log messages
it can not recognize. We encourage mudlib designers to produce NDLF-compatible log messages for the advantages of structured log format.

Example below is a Neolith debug log file with ES2 mudlib (mixing NDLF messages and non-NDLF message produced by mudlib):
```
2022-10-05 13:10:54     {}      ===== neolith version 0.1.3 starting up =====
2022-10-05 13:10:54     {}      using locale "C.UTF-8"
2022-10-05 13:10:54     {}      using MudLibDir "/home/taedlar/github/es2_mudlib/mudlib"
2022-10-05 13:10:54     {}      ----- loading simul efuns -----
2022-10-05 13:10:54     simul_efun loaded successfully.
2022-10-05 13:10:54     {}      ----- loading master -----
2022-10-05 13:10:54     master object is created successfully.
2022-10-05 13:10:54     {}      ----- epilogue -----
2022-10-05 13:10:54     preloading /adm/daemons/securityd
2022-10-05 13:10:54     preloading /adm/daemons/virtuald
2022-10-05 13:10:54     preloading /adm/daemons/logind
2022-10-05 13:10:54     preloading /adm/daemons/cmd_d
2022-10-05 13:10:54     preloading /adm/daemons/chinesed
2022-10-05 13:10:54     dictionary restored 238 words
2022-10-05 13:10:54     preloading /adm/daemons/emoted
2022-10-05 13:10:54     preloading /adm/daemons/aliasd
2022-10-05 13:10:54     preloading /adm/daemons/fingerd
2022-10-05 13:10:54     preloading /adm/daemons/channeld
2022-10-05 13:10:54     preloading /adm/daemons/natured
2022-10-05 13:10:54     preloading /adm/daemons/enterd
2022-10-05 13:10:54     {}      ----- entering MUD -----
2022-10-05 13:10:57     new connection from ip address "127.0.0.1"
2022-10-05 13:11:03     ["ERROR","interpret.c",3639,"eval_instruction"] Bad stack after evaluation. Instruction 93
2022-10-05 13:11:03     ["ERROR","interpret.c",3639,"eval_instruction"] Bad stack after evaluation. Instruction 93
2022-10-05 13:11:03     ["ERROR","interpret.c",3639,"eval_instruction"] Bad stack after evaluation. Instruction 93
2022-10-05 13:11:03     ["ERROR","interpret.c",3639,"eval_instruction"] Bad stack after evaluation. Instruction 93```
